"use strict";var _monoForm={isInTool:document.body.hasAttribute("data-istool"),$forms:$(".module.form"),init:function(){var e=this;this.$forms.each(function(t,a){e.setConditionals($(a)),e.bindLabelsClick($(a))}),this.$forms.find(".g-recaptcha").length&&(window.formsInitRecaptcha=function(){e.initRecaptcha()}),e.initLocation(this.$forms.find("input[data-type='location']")),e.initDatepicker(this.$forms.find("input[data-type='datepicker']")),this.$forms.find("a[data-overlay-trigger]").length>0&&this.$forms.find("a[data-overlay-trigger]").monooverlay()},validateRecaptcha:function(e){var t=this,a=e.getAttribute("data-widgetid");grecaptcha.execute(a),window._monoLoader.utils.waitFor(function(){return grecaptcha.getResponse(a).length},function(){t.submitForm(e)},7e3,50)},submitForm:function(e){if($(e).find(".g-recaptcha").attr("data-invisible")&&$(e).find(".g-recaptcha").attr("data-invisible").length){var t=e.getAttribute("data-widgetid");if(!grecaptcha.getResponse(t).length)return this.validateRecaptcha(e),!1}var a=this,i=$(e),n=a.validateFields(i);if(a.toggleLoading(i),n.valid){if(!window.FormData)return!0;var r=i.serializeArray(),o=new FormData;i.find('input[type="file"]').each(function(e,t){$.each(t.files,function(e,a){r.push({name:t.name,value:a})})}),o.append("currentUrl",window.location.href),$.each(r,function(){o.append(this.name,this.value)}),$.ajax({type:"POST",url:i.attr("data-url"),data:o,contentType:!1,processData:!1,success:function(e){if(e.match(/^\{\"redirect\":.*}$/))return e=JSON.parse(e),void(window.location=e.redirect);var t=$(e);i.replaceWith(t),t.find(".g-recaptcha").length&&a.initRecaptcha(t),a.bindLabelsClick(t)},error:function(e){a.toggleLoading(i),413==e.status&&a.showError("requestTooLarge",i)}}),window._mtr&&i.attr("data-track-action")&&window._mtr.track(i.attr("data-track-action"))}else a.toggleLoading(i),a.showFieldErrors(i,n.fields);return!1},submitComment:function(e){if($(e).find(".g-recaptcha").attr("data-invisible")&&$(e).find(".g-recaptcha").attr("data-invisible").length){var t=e.getAttribute("data-widgetid");if(!grecaptcha.getResponse(t).length)return this.validateRecaptcha(e),!1}var a=this,i=$(e),n=window.location.href,r=a.validateFields(i);if(a.toggleLoading(i),!window.FormData)return!0;var o=i.serializeArray(),d=new FormData;return i.find('input[type="file"]').each(function(e,t){$.each(t.files,function(e,a){o.push({name:t.name,value:a})})}),$.each(o,function(){d.append(this.name,this.value)}),r.valid?($.ajax({type:"POST",url:n,data:d,contentType:!1,processData:!1,success:function(e){var t,a=JSON.parse(e),n="<div class='submitConfirmation'>"+a.thankyoumsg+"</div>";if(i.replaceWith(n),Object.keys(a).length>1&&$(".commentsList").length){var r=parseInt($("#numOfComm").text());t='<p class="smalltext commentsInfoText">'+a.created+" "+_monoLang.get("##BLOG_GENERAL_BY_LABEL##")+" "+a.author+"</p>",t+='<div class="module text">',t+='<p class="bodytext commentContent">'+a.content+"</p>",t+="</div>",$(".commentsList").append(t),$("#numOfComm").html(r+1),$("#commentsArea").hasClass("hidden")&&$("#commentsArea").removeClass("hidden")}},error:function(e){a.toggleLoading(i),413==e.status&&a.showError("requestTooLarge",i)}}),window._mtr&&window._mtr.track("comment_send")):(a.toggleLoading(i),a.showFieldErrors(i,r.fields)),!1},validateFields:function(e){var t=e.find("input, select, textarea").not(":disabled, [type=submit]"),a={valid:!0,fields:{}};t=t.filter(function(e,a){return"checkbox"!=a.type&&"radio"!=a.type||!e||t[e-1].name!=a.name?!0:!1}),t.each(function(e,t){var i=$(t),n=i.attr("name").replace("[]",""),r=i.attr("type");"checkbox"==r||"radio"==r?!i.attr("data-required")||i.attr("data-required")&&(i[0].checked||i.parents(".module.form").find("[type="+i.attr("type")+"][name*="+n+"]:checked").length>0)?a.fields[n]=!0:a.fields[n]=!1:"g-recaptcha-response"==n?i[0].value?a.fields[n]=!0:a.fields[n]=!1:!i.attr("data-required")||i.attr("data-required")&&""!==i[0].value?(a.fields[n]=!0,"email"==i.attr("data-type")&&i.val().length>0&&!i.val().match(/^[a-zA-Z0-9_\.\-+]+@[a-zA-Z0-9\-]+\.[a-zA-Z0-9\-\.]+$/)&&(a.fields[n]="notValidEmail"),"phone"==i.attr("data-type")&&i.val().length>0&&!i.val().match(/^[0-9\+\s\-(),.]{1,25}$/)&&(a.fields[n]="notValidPhone")):a.fields[n]=!1});for(var i in a.fields)if(a.fields[i]===!1||"notValidEmail"==a.fields[i]||"notValidPhone"==a.fields[i]){a.valid=!1;break}return a},toggleLoading:function(e){e.toggleClass("loading")},showError:function(e,t){var a,i=t.attr("id");switch(t.find(".error").empty(),t.find("#errors_"+i).empty().append('<div class="errors"></div>'),e){case"requestTooLarge":a="<p>* "+_monoLang.get("##MODULE_FORM_ERR_REQUESTTOOLARGE##").replace("%s","25MB")+"</p>"}t.find("div#errors_"+i+" .errors").append(a)},showFieldErrors:function(e,t){var a=e.attr("id"),i=void 0,n=[];e.find(".error").empty(),e.find("#errors_"+a).empty().append('<div class="errors"></div>');for(i in t){e.find('*[name="'+i+'"]').removeClass("requiredMark");var r=("span.label_"+i).replace(/optin_/,"");if(e.find(r).removeClass("requiredMarkLabel"),t[i]!==!0)if("g-recaptcha-response"!==i||t[i]!==!1){var o=e.find("label[for="+a+"_"+i+"]").text(),d=e.find('*[name="'+i+'"]').attr("placeholder")||"";o||(o=e.find(r).contents().filter(function(){return 1===this.nodeType||3===this.nodeType}).text());var s=o.replace(/\s/g,"").length>0?o:d;s=s.replace(/\*$/,"").replace(/(^\s*|\s*$)/g,""),t[i]===!1&&(e.find("div#errors_"+a+" .errors").append("<p>* '"+s+"' "+_monoLang.get("##MODULE_FORM_ERR_REQUIRED##")+"</p>"),e.find('*[name="'+i+'"]').addClass("requiredMark"),e.find(r).addClass("requiredMarkLabel"),n.push(i)),"notValidEmail"===t[i]&&(e.find("div#errors_"+a+" .errors").append("<p>* '"+s+"' "+_monoLang.get("##MODULE_FORM_ERR_EMAIL##")+"</p>"),e.find('*[name="'+i+'"]').addClass("requiredMark")),"notValidPhone"===t[i]&&(e.find("div#errors_"+a+" .errors").append("<p>* '"+s+"' "+_monoLang.get("##MODULE_FORM_ERR_PHONE##")+"</p>"),e.find('*[name="'+i+'"]').addClass("requiredMark"))}else e.find("div#errors_"+a+"  .errors").append("<p>* "+_monoLang.get("##MODULE_FORM_ERR_RECAPTCHA##")+"</p>")}n.length>0&&e.find('*[name="'+n[0]+'"]').focus()},setConditionals:function(e){var t=this,a=e.find(".conditional");a.length&&(a.not(".show").find("input, select, textarea").prop("disabled",!0),a.each(function(a,i){var n=$(i).attr("data-condition").match(/^([^,]+),(.+)$/);if(n&&3===n.length){var r=n[1],o=n[2],d=e.find('[name="'+r+'"][value="'+o+'"]').length?e.find('[name="'+r+'"][value="'+o+'"]'):e.find('[name="'+r+'[]"][value="'+o+'"]'),s=d.attr("type");d.is(":checked")&&$(i).addClass("show").find("input, select, textarea").prop("disabled",!1),"checkbox"===s?d.on("change",function(){$(this).is(":checked")?t.showHideConditional($(i)):t.showHideConditional($(i),1)}):"radio"===s&&e.find('[name="'+r+'"]').on("change",function(){this.value===o?t.showHideConditional($(i)):t.showHideConditional($(i),1)})}}))},showHideConditional:function(e,t){t?e.removeClass("show").find("input, select, textarea").prop("disabled",!0):e.addClass("show").find("input, select, textarea").prop("disabled",!1)},bindLabelsClick:function(e){var t=e.find('span[class*="label_field"]');t.on("click",function(e){"SPAN"!==e.target.nodeName&&$(e.currentTarget).parents("optins")||("radio"===this.previousSibling.type?this.previousSibling.checked=!0:this.previousSibling.checked=!this.previousSibling.checked,$(this.previousSibling).focus(),$(this.previousSibling).trigger("change"))})},initRecaptcha:function(){function e(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal",a=grecaptcha.render(e[0],{sitekey:e.attr("data-sitekey"),size:t});e.parents(".form").attr("data-widgetid",a)}var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.$forms;t.each(function(t,a){var i=$(a).find(".g-recaptcha");if(!i.length)return!0;if($(a).width()){var n=$(a).width()>304?"normal":"compact";$(a).find(".g-recaptcha").attr("data-invisible")&&$(a).find(".g-recaptcha").attr("data-invisible").length&&(n="invisible"),e(i,n)}else var r=setInterval(function(){if($(a).width()){clearInterval(r);var t=$(a).width()>304?"normal":"compact";$(a).find(".g-recaptcha").attr("data-invisible")&&$(a).find(".g-recaptcha").attr("data-invisible").length&&(t="invisible"),e(i,t)}},500)})},initLocation:function(e){var t=!1;$(e).focus(function(){t||(t=new google.maps.places.Autocomplete(this))}),$(e).keypress(function(e){13==e.which&&e.preventDefault()})},initDatepicker:function(e){function t(){$.fn.datetimepicker&&($.datetimepicker.setLocale(i),$(e).datetimepicker({timepicker:!1,lazyInit:!0,scrollMonth:!1,format:a}),clearInterval(n))}var a=$("body").attr("data-dateformat"),i=$("html").attr("lang"),n=setInterval(t,200)}};_monoForm.init();